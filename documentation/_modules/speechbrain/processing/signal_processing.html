

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>speechbrain.processing.signal_processing &mdash; SpeechBrain 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SpeechBrain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Quick installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#install-via-pypi">Install via PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#install-locally">Install locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#test-installation">Test Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../experiment.html">Running an experiment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../experiment.html#yaml-basics">YAML basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../experiment.html#running-arguments">Running arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../experiment.html#tensor-format">Tensor format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../multigpu.html">Basics of multi-GPU</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../multigpu.html#multi-gpu-training-using-data-parallel">Multi-GPU training using Data Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../multigpu.html#multi-gpu-training-using-distributed-data-parallel-ddp">Multi-GPU training using Distributed Data Parallel (DDP)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../multigpu.html#with-multiple-machines-suppose-you-have-2-servers-with-2-gpus">With multiple machines (suppose you have 2 servers with 2 GPUs):</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#zen-of-speechbrain">Zen of Speechbrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#how-to-get-your-code-in-speechbrain">How to get your code in SpeechBrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#python">Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#formatting">Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#adding-dependencies">Adding dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#development-tools">Development tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#flake8">flake8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#pre-commit">pre-commit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#the-git-pre-commit-hooks">the git pre-commit hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#the-git-pre-push-hooks">the git pre-push hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#pytest-doctests">pytest doctests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#continuous-integration">Continuous integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#what-is-ci">What is CI?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#ci-cd-pipelines">CI / CD Pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#our-test-suite">Our test suite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#pull-request-review-guide">Pull Request review guide</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../speechbrain.html">Core library (speechbrain)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.core.html">speechbrain.core module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.core.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.core.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.yaml.html">speechbrain.yaml module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.alignment.html">speechbrain.alignment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.alignment.aligner.html">speechbrain.alignment.aligner module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.alignment.aligner.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.alignment.aligner.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.dataio.html">speechbrain.dataio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.batch.html">speechbrain.dataio.batch module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.batch.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.batch.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.dataio.html">speechbrain.dataio.dataio module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataio.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataio.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.dataloader.html">speechbrain.dataio.dataloader module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataloader.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataloader.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.dataset.html">speechbrain.dataio.dataset module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataset.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataset.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.encoder.html">speechbrain.dataio.encoder module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.encoder.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.encoder.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.legacy.html">speechbrain.dataio.legacy module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.legacy.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.legacy.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.sampler.html">speechbrain.dataio.sampler module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.sampler.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.sampler.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.wer.html">speechbrain.dataio.wer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.wer.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.wer.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.decoders.html">speechbrain.decoders</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.decoders.ctc.html">speechbrain.decoders.ctc module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.ctc.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.ctc.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.decoders.seq2seq.html">speechbrain.decoders.seq2seq module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.seq2seq.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.seq2seq.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.decoders.transducer.html">speechbrain.decoders.transducer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.transducer.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.transducer.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.lm.html">speechbrain.lm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lm.arpa.html">speechbrain.lm.arpa module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.arpa.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.arpa.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lm.counting.html">speechbrain.lm.counting module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.counting.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.counting.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lm.ngram.html">speechbrain.lm.ngram module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.ngram.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.ngram.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.lobes.html">speechbrain.lobes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lobes.augment.html">speechbrain.lobes.augment module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.augment.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.augment.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lobes.features.html">speechbrain.lobes.features module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.features.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.features.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lobes.models.html">speechbrain.lobes.models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.CRDNN.html">speechbrain.lobes.models.CRDNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.ContextNet.html">speechbrain.lobes.models.ContextNet module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.ECAPA_TDNN.html">speechbrain.lobes.models.ECAPA_TDNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.ESPnetVGG.html">speechbrain.lobes.models.ESPnetVGG module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.MetricGAN_D.html">speechbrain.lobes.models.MetricGAN_D module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.RNNLM.html">speechbrain.lobes.models.RNNLM module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.VanillaNN.html">speechbrain.lobes.models.VanillaNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.Xvector.html">speechbrain.lobes.models.Xvector module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.conv_tasnet.html">speechbrain.lobes.models.conv_tasnet module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.convolution.html">speechbrain.lobes.models.convolution module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.dual_path.html">speechbrain.lobes.models.dual_path module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.transformer.html">speechbrain.lobes.models.transformer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.nnet.html">speechbrain.nnet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.CNN.html">speechbrain.nnet.CNN module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.CNN.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.CNN.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.RNN.html">speechbrain.nnet.RNN module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.RNN.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.RNN.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.activations.html">speechbrain.nnet.activations module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.activations.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.activations.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.attention.html">speechbrain.nnet.attention module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.attention.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.attention.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.containers.html">speechbrain.nnet.containers module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.containers.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.containers.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.dropout.html">speechbrain.nnet.dropout module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.dropout.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.dropout.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.embedding.html">speechbrain.nnet.embedding module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.embedding.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.embedding.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.linear.html">speechbrain.nnet.linear module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.linear.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.linear.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.losses.html">speechbrain.nnet.losses module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.losses.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.losses.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.normalization.html">speechbrain.nnet.normalization module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.normalization.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.normalization.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.pooling.html">speechbrain.nnet.pooling module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.pooling.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.pooling.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.schedulers.html">speechbrain.nnet.schedulers module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.schedulers.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.schedulers.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.html">speechbrain.nnet.complex_networks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_CNN.html">speechbrain.nnet.complex_networks.c_CNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_RNN.html">speechbrain.nnet.complex_networks.c_RNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_linear.html">speechbrain.nnet.complex_networks.c_linear module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_normalization.html">speechbrain.nnet.complex_networks.c_normalization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_ops.html">speechbrain.nnet.complex_networks.c_ops module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.loss.html">speechbrain.nnet.loss</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.loss.stoi_loss.html">speechbrain.nnet.loss.stoi_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.loss.transducer_loss.html">speechbrain.nnet.loss.transducer_loss module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.html">speechbrain.nnet.quaternion_networks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_CNN.html">speechbrain.nnet.quaternion_networks.q_CNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_RNN.html">speechbrain.nnet.quaternion_networks.q_RNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_linear.html">speechbrain.nnet.quaternion_networks.q_linear module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_normalization.html">speechbrain.nnet.quaternion_networks.q_normalization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_ops.html">speechbrain.nnet.quaternion_networks.q_ops module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.transducer.html">speechbrain.nnet.transducer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.transducer.transducer_joint.html">speechbrain.nnet.transducer.transducer_joint module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.processing.html">speechbrain.processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.NMF.html">speechbrain.processing.NMF module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.NMF.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.NMF.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.PLDA_LDA.html">speechbrain.processing.PLDA_LDA module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.PLDA_LDA.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.PLDA_LDA.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.decomposition.html">speechbrain.processing.decomposition module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.decomposition.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.decomposition.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.diarization.html">speechbrain.processing.diarization module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.diarization.html#reference">Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.diarization.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.diarization.html#id1">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.features.html">speechbrain.processing.features module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.features.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.features.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.multi_mic.html">speechbrain.processing.multi_mic module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.multi_mic.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.multi_mic.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.signal_processing.html">speechbrain.processing.signal_processing module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.signal_processing.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.signal_processing.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.speech_augmentation.html">speechbrain.processing.speech_augmentation module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.speech_augmentation.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.speech_augmentation.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.tokenizers.html">speechbrain.tokenizers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.tokenizers.SentencePiece.html">speechbrain.tokenizers.SentencePiece module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.tokenizers.SentencePiece.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.tokenizers.SentencePiece.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.utils.html">speechbrain.utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.Accuracy.html">speechbrain.utils.Accuracy module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.Accuracy.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.Accuracy.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.DER.html">speechbrain.utils.DER module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.DER.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.DER.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.checkpoints.html">speechbrain.utils.checkpoints module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.checkpoints.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.checkpoints.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.convert_model.html">speechbrain.utils.convert_model module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.data_pipeline.html">speechbrain.utils.data_pipeline module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_pipeline.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_pipeline.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.data_utils.html">speechbrain.utils.data_utils module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_utils.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_utils.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.depgraph.html">speechbrain.utils.depgraph module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.depgraph.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.depgraph.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.distributed.html">speechbrain.utils.distributed module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.distributed.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.distributed.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.edit_distance.html">speechbrain.utils.edit_distance module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.edit_distance.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.edit_distance.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.epoch_loop.html">speechbrain.utils.epoch_loop module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.epoch_loop.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.epoch_loop.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.logger.html">speechbrain.utils.logger module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.logger.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.logger.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.metric_stats.html">speechbrain.utils.metric_stats module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.metric_stats.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.metric_stats.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.parameter_transfer.html">speechbrain.utils.parameter_transfer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.parameter_transfer.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.parameter_transfer.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.superpowers.html">speechbrain.utils.superpowers module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.superpowers.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.superpowers.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.train_logger.html">speechbrain.utils.train_logger module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.train_logger.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.train_logger.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools.html">Runnable Tools (tools)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.compute_wer.html">tools.compute_wer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tools.compute_wer.html#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SpeechBrain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>speechbrain.processing.signal_processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for speechbrain.processing.signal_processing</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Low level signal processing utilities</span>

<span class="sd">Authors</span>
<span class="sd"> * Peter Plantinga 2020</span>
<span class="sd"> * Francois Grondin 2020</span>
<span class="sd"> * William Aris 2020</span>
<span class="sd"> * Samuele Cornell 2020</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="k">import</span> <span class="n">version</span>


<div class="viewcode-block" id="compute_amplitude"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.compute_amplitude">[docs]</a><span class="k">def</span> <span class="nf">compute_amplitude</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amp_type</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute amplitude of a batch of waveforms.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    waveform : tensor</span>
<span class="sd">        The waveforms used for computing amplitude.</span>
<span class="sd">        Shape should be `[time]` or `[batch, time]` or</span>
<span class="sd">        `[batch, time, channels]`.</span>
<span class="sd">    lengths : tensor</span>
<span class="sd">        The lengths of the waveforms excluding the padding.</span>
<span class="sd">        Shape should be a single dimension, `[batch]`.</span>
<span class="sd">    amp_type : str</span>
<span class="sd">        Whether to compute &quot;avg&quot; average or &quot;peak&quot; amplitude.</span>
<span class="sd">        Choose between [&quot;avg&quot;, &quot;peak&quot;].</span>
<span class="sd">    scale : str</span>
<span class="sd">        Whether to compute amplitude in &quot;dB&quot; or &quot;linear&quot; scale.</span>
<span class="sd">        Choose between [&quot;linear&quot;, &quot;dB&quot;].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The average amplitude of the waveforms.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; signal = torch.sin(torch.arange(16000.0)).unsqueeze(0)</span>
<span class="sd">    &gt;&gt;&gt; compute_amplitude(signal, signal.size(1))</span>
<span class="sd">    tensor([[0.6366]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">amp_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;peak&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">scale</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;dB&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">amp_type</span> <span class="o">==</span> <span class="s2">&quot;avg&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lengths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveforms</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wav_sum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveforms</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">wav_sum</span> <span class="o">/</span> <span class="n">lengths</span>
    <span class="k">elif</span> <span class="n">amp_type</span> <span class="o">==</span> <span class="s2">&quot;peak&quot;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waveforms</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;dB&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">80</span><span class="p">)</span>  <span class="c1"># clamp zeros</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amp_type</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">14</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function normalizes a signal to unitary average or peak amplitude.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    waveforms : tensor</span>
<span class="sd">        The waveforms to normalize.</span>
<span class="sd">        Shape should be `[batch, time]` or `[batch, time, channels]`.</span>
<span class="sd">    lengths : tensor</span>
<span class="sd">        The lengths of the waveforms excluding the padding.</span>
<span class="sd">        Shape should be a single dimension, `[batch]`.</span>
<span class="sd">    amp_type : str</span>
<span class="sd">        Whether one wants to normalize with respect to &quot;avg&quot; or &quot;peak&quot;</span>
<span class="sd">        amplitude. Choose between [&quot;avg&quot;, &quot;peak&quot;]. Note: for &quot;avg&quot; clipping</span>
<span class="sd">        is not prevented and can occur.</span>
<span class="sd">    eps : float</span>
<span class="sd">        A small number to add to the denominator to prevent NaN.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    waveforms : tensor</span>
<span class="sd">        Normalized level waveform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">amp_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;peak&quot;</span><span class="p">]</span>

    <span class="n">batch_added</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">batch_added</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">den</span> <span class="o">=</span> <span class="n">compute_amplitude</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">amp_type</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span>
    <span class="k">if</span> <span class="n">batch_added</span><span class="p">:</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">waveforms</span> <span class="o">/</span> <span class="n">den</span></div>


<div class="viewcode-block" id="rescale"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.rescale">[docs]</a><span class="k">def</span> <span class="nf">rescale</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">target_lvl</span><span class="p">,</span> <span class="n">amp_type</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This functions performs signal rescaling to a target level.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    waveforms : tensor</span>
<span class="sd">        The waveforms to normalize.</span>
<span class="sd">        Shape should be `[batch, time]` or `[batch, time, channels]`.</span>
<span class="sd">    lengths : tensor</span>
<span class="sd">        The lengths of the waveforms excluding the padding.</span>
<span class="sd">        Shape should be a single dimension, `[batch]`.</span>
<span class="sd">    target_lvl : float</span>
<span class="sd">        Target lvl in dB or linear scale.</span>
<span class="sd">    amp_type : str</span>
<span class="sd">        Whether one wants to rescale with respect to &quot;avg&quot; or &quot;peak&quot; amplitude.</span>
<span class="sd">        Choose between [&quot;avg&quot;, &quot;peak&quot;].</span>
<span class="sd">    scale : str</span>
<span class="sd">        whether target_lvl belongs to linear or dB scale.</span>
<span class="sd">        Choose between [&quot;linear&quot;, &quot;dB&quot;].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    waveforms : tensor</span>
<span class="sd">        Rescaled waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">amp_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;peak&quot;</span><span class="p">,</span> <span class="s2">&quot;avg&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">scale</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;dB&quot;</span><span class="p">]</span>

    <span class="n">batch_added</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">batch_added</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">amp_type</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">target_lvl</span> <span class="o">*</span> <span class="n">waveforms</span>
    <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;dB&quot;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">dB_to_amplitude</span><span class="p">(</span><span class="n">target_lvl</span><span class="p">)</span> <span class="o">*</span> <span class="n">waveforms</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Invalid scale, choose between dB and linear&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_added</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="convolve1d"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.convolve1d">[docs]</a><span class="k">def</span> <span class="nf">convolve1d</span><span class="p">(</span>
    <span class="n">waveform</span><span class="p">,</span>
    <span class="n">kernel</span><span class="p">,</span>
    <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">pad_type</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">groups</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">use_fft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rotation_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use torch.nn.functional to perform 1d padding and conv.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    waveform : tensor</span>
<span class="sd">        The tensor to perform operations on.</span>
<span class="sd">    kernel : tensor</span>
<span class="sd">        The filter to apply during convolution.</span>
<span class="sd">    padding : int or tuple</span>
<span class="sd">        The padding (pad_left, pad_right) to apply.</span>
<span class="sd">        If an integer is passed instead, this is passed</span>
<span class="sd">        to the conv1d function and pad_type is ignored.</span>
<span class="sd">    pad_type : str</span>
<span class="sd">        The type of padding to use. Passed directly to</span>
<span class="sd">        `torch.nn.functional.pad`, see PyTorch documentation</span>
<span class="sd">        for available options.</span>
<span class="sd">    stride : int</span>
<span class="sd">        The number of units to move each time convolution is applied.</span>
<span class="sd">        Passed to conv1d. Has no effect if `use_fft` is True.</span>
<span class="sd">    groups : int</span>
<span class="sd">        This option is passed to `conv1d` to split the input into groups for</span>
<span class="sd">        convolution. Input channels should be divisible by the number of groups.</span>
<span class="sd">    use_fft : bool</span>
<span class="sd">        When `use_fft` is passed `True`, then compute the convolution in the</span>
<span class="sd">        spectral domain using complex multiply. This is more efficient on CPU</span>
<span class="sd">        when the size of the kernel is large (e.g. reverberation). WARNING:</span>
<span class="sd">        Without padding, circular convolution occurs. This makes little</span>
<span class="sd">        difference in the case of reverberation, but may make more difference</span>
<span class="sd">        with different kernels.</span>
<span class="sd">    rotation_index : int</span>
<span class="sd">        This option only applies if `use_fft` is true. If so, the kernel is</span>
<span class="sd">        rolled by this amount before convolution to shift the output location.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The convolved waveform.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from speechbrain.dataio.dataio import read_audio</span>
<span class="sd">    &gt;&gt;&gt; signal = read_audio(&#39;samples/audio_samples/example1.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; signal = signal.unsqueeze(0).unsqueeze(2)</span>
<span class="sd">    &gt;&gt;&gt; kernel = torch.rand(1, 10, 1)</span>
<span class="sd">    &gt;&gt;&gt; signal = convolve1d(signal, kernel, padding=(9, 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Convolve1D expects a 3-dimensional tensor&quot;</span><span class="p">)</span>

    <span class="c1"># Move time dimension last, which pad and fft and conv expect.</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Padding can be a tuple (left_pad, right_pad) or an int</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">waveform</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_type</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># This approach uses FFT, which is more efficient if the kernel is large</span>
    <span class="k">if</span> <span class="n">use_fft</span><span class="p">:</span>

        <span class="c1"># Pad kernel to same length as signal, ensuring correct alignment</span>
        <span class="n">zero_length</span> <span class="o">=</span> <span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">kernel</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Handle case where signal is shorter</span>
        <span class="k">if</span> <span class="n">zero_length</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="n">zero_length</span><span class="p">]</span>
            <span class="n">zero_length</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Perform rotation to ensure alignment</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="n">kernel</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">kernel</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero_length</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">kernel</span><span class="o">.</span><span class="n">device</span>
        <span class="p">)</span>
        <span class="n">after_index</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">rotation_index</span><span class="p">:]</span>
        <span class="n">before_index</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="n">rotation_index</span><span class="p">]</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">after_index</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">before_index</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Multiply in frequency domain to convolve in time domain</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.6.0&quot;</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">torch.fft</span> <span class="k">as</span> <span class="nn">fft</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">waveform</span><span class="p">)</span> <span class="o">*</span> <span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_signal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">waveform</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">f_kernel</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">sig_real</span><span class="p">,</span> <span class="n">sig_imag</span> <span class="o">=</span> <span class="n">f_signal</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ker_real</span><span class="p">,</span> <span class="n">ker_imag</span> <span class="o">=</span> <span class="n">f_kernel</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">f_result</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">sig_real</span> <span class="o">*</span> <span class="n">ker_real</span> <span class="o">-</span> <span class="n">sig_imag</span> <span class="o">*</span> <span class="n">ker_imag</span><span class="p">,</span>
                    <span class="n">sig_real</span> <span class="o">*</span> <span class="n">ker_imag</span> <span class="o">+</span> <span class="n">sig_imag</span> <span class="o">*</span> <span class="n">ker_real</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">convolved</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span>
                <span class="n">f_result</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">signal_sizes</span><span class="o">=</span><span class="p">[</span><span class="n">waveform</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="p">)</span>

    <span class="c1"># Use the implementation given by torch, which should be efficient on GPU</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">convolved</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv1d</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">waveform</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
            <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
            <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">padding</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Return time dimension to the second dimension.</span>
    <span class="k">return</span> <span class="n">convolved</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="reverberate"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.reverberate">[docs]</a><span class="k">def</span> <span class="nf">reverberate</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">rir_waveform</span><span class="p">,</span> <span class="n">rescale_amp</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General function to contaminate a given signal with reverberation given a</span>
<span class="sd">    Room Impulse Response (RIR).</span>
<span class="sd">    It performs convolution between RIR and signal, but without changing</span>
<span class="sd">    the original amplitude of the signal.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    waveforms : tensor</span>
<span class="sd">        The waveforms to normalize.</span>
<span class="sd">        Shape should be `[batch, time]` or `[batch, time, channels]`.</span>
<span class="sd">    rir_waveform : tensor</span>
<span class="sd">        RIR tensor, shape should be [time, channels].</span>
<span class="sd">    rescale_amp : str</span>
<span class="sd">        Whether reverberated signal is rescaled (None) and with respect either</span>
<span class="sd">        to original signal &quot;peak&quot; amplitude or &quot;avg&quot; average amplitude.</span>
<span class="sd">        Choose between [None, &quot;avg&quot;, &quot;peak&quot;].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    waveforms: tensor</span>
<span class="sd">        Reverberated signal.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">orig_shape</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">rir_waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="c1"># if inputs are mono tensors we reshape to 1, samples</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rir_waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># convolve1d expects a 3d tensor !</span>
        <span class="n">rir_waveform</span> <span class="o">=</span> <span class="n">rir_waveform</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rir_waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">rir_waveform</span> <span class="o">=</span> <span class="n">rir_waveform</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute the average amplitude of the clean</span>
    <span class="n">orig_amplitude</span> <span class="o">=</span> <span class="n">compute_amplitude</span><span class="p">(</span>
        <span class="n">waveforms</span><span class="p">,</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">rescale_amp</span>
    <span class="p">)</span>

    <span class="c1"># Compute index of the direct signal, so we can preserve alignment</span>
    <span class="n">value_max</span><span class="p">,</span> <span class="n">direct_index</span> <span class="o">=</span> <span class="n">rir_waveform</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Making sure the max is always positive (if not, flip)</span>
    <span class="c1"># mask = torch.logical_and(rir_waveform == value_max,  rir_waveform &lt; 0)</span>
    <span class="c1"># rir_waveform[mask] = -rir_waveform[mask]</span>

    <span class="c1"># Use FFT to compute convolution, because of long reverberation filter</span>
    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">convolve1d</span><span class="p">(</span>
        <span class="n">waveform</span><span class="o">=</span><span class="n">waveforms</span><span class="p">,</span>
        <span class="n">kernel</span><span class="o">=</span><span class="n">rir_waveform</span><span class="p">,</span>
        <span class="n">use_fft</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">rotation_index</span><span class="o">=</span><span class="n">direct_index</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Rescale to the peak amplitude of the clean waveform</span>
    <span class="n">waveforms</span> <span class="o">=</span> <span class="n">rescale</span><span class="p">(</span>
        <span class="n">waveforms</span><span class="p">,</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">orig_amplitude</span><span class="p">,</span> <span class="n">rescale_amp</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">orig_shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">waveforms</span></div>


<div class="viewcode-block" id="dB_to_amplitude"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.dB_to_amplitude">[docs]</a><span class="k">def</span> <span class="nf">dB_to_amplitude</span><span class="p">(</span><span class="n">SNR</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the amplitude ratio, converted from decibels.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    SNR : float</span>
<span class="sd">        The ratio in decibels to convert.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; round(dB_to_amplitude(SNR=10), 3)</span>
<span class="sd">    3.162</span>
<span class="sd">    &gt;&gt;&gt; dB_to_amplitude(SNR=0)</span>
<span class="sd">    1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">SNR</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span></div>


<div class="viewcode-block" id="notch_filter"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.notch_filter">[docs]</a><span class="k">def</span> <span class="nf">notch_filter</span><span class="p">(</span><span class="n">notch_freq</span><span class="p">,</span> <span class="n">filter_width</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">notch_width</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a notch filter constructed from a high-pass and low-pass filter.</span>

<span class="sd">    (from https://tomroelandts.com/articles/</span>
<span class="sd">    how-to-create-simple-band-pass-and-band-reject-filters)</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    notch_freq : float</span>
<span class="sd">        frequency to put notch as a fraction of the</span>
<span class="sd">        sampling rate / 2. The range of possible inputs is 0 to 1.</span>
<span class="sd">    filter_width : int</span>
<span class="sd">        Filter width in samples. Longer filters have</span>
<span class="sd">        smaller transition bands, but are more inefficient.</span>
<span class="sd">    notch_width : float</span>
<span class="sd">        Width of the notch, as a fraction of the sampling_rate / 2.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from speechbrain.dataio.dataio import read_audio</span>
<span class="sd">    &gt;&gt;&gt; signal = read_audio(&#39;samples/audio_samples/example1.wav&#39;)</span>
<span class="sd">    &gt;&gt;&gt; signal = signal.unsqueeze(0).unsqueeze(2)</span>
<span class="sd">    &gt;&gt;&gt; kernel = notch_filter(0.25)</span>
<span class="sd">    &gt;&gt;&gt; notched_signal = convolve1d(signal, kernel)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check inputs</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">notch_freq</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">filter_width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="n">filter_width</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">filter_width</span><span class="p">)</span> <span class="o">-</span> <span class="n">pad</span>

    <span class="c1"># Avoid frequencies that are too low</span>
    <span class="n">notch_freq</span> <span class="o">+=</span> <span class="n">notch_width</span>

    <span class="c1"># Define sinc function, avoiding division by zero</span>
    <span class="k">def</span> <span class="nf">sinc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span>

        <span class="c1"># The zero is at the middle index</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">pad</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pad</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])])</span>

    <span class="c1"># Compute a low-pass filter with cutoff frequency notch_freq.</span>
    <span class="n">hlpf</span> <span class="o">=</span> <span class="n">sinc</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">notch_freq</span> <span class="o">-</span> <span class="n">notch_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">inputs</span><span class="p">)</span>
    <span class="n">hlpf</span> <span class="o">*=</span> <span class="n">torch</span><span class="o">.</span><span class="n">blackman_window</span><span class="p">(</span><span class="n">filter_width</span><span class="p">)</span>
    <span class="n">hlpf</span> <span class="o">/=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hlpf</span><span class="p">)</span>

    <span class="c1"># Compute a high-pass filter with cutoff frequency notch_freq.</span>
    <span class="n">hhpf</span> <span class="o">=</span> <span class="n">sinc</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">notch_freq</span> <span class="o">+</span> <span class="n">notch_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">inputs</span><span class="p">)</span>
    <span class="n">hhpf</span> <span class="o">*=</span> <span class="n">torch</span><span class="o">.</span><span class="n">blackman_window</span><span class="p">(</span><span class="n">filter_width</span><span class="p">)</span>
    <span class="n">hhpf</span> <span class="o">/=</span> <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hhpf</span><span class="p">)</span>
    <span class="n">hhpf</span><span class="p">[</span><span class="n">pad</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Adding filters creates notch filter</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">hlpf</span> <span class="o">+</span> <span class="n">hhpf</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="overlap_and_add"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.overlap_and_add">[docs]</a><span class="k">def</span> <span class="nf">overlap_and_add</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">frame_step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Taken from https://github.com/kaituoxu/Conv-TasNet/blob/master/src/utils.py</span>

<span class="sd">    Reconstructs a signal from a framed representation.</span>
<span class="sd">    Adds potentially overlapping frames of a signal with shape</span>
<span class="sd">    `[..., frames, frame_length]`, offsetting subsequent frames by `frame_step`.</span>
<span class="sd">    The resulting tensor has shape `[..., output_size]` where</span>
<span class="sd">        output_size = (frames - 1) * frame_step + frame_length</span>
<span class="sd">    Args:</span>
<span class="sd">        signal: A [..., frames, frame_length] Tensor. All dimensions may be unknown, and rank must be at least 2.</span>
<span class="sd">        frame_step: An integer denoting overlap offsets. Must be less than or equal to frame_length.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A Tensor with shape [..., output_size] containing the overlap-added frames of signal&#39;s inner-most two dimensions.</span>
<span class="sd">        output_size = (frames - 1) * frame_step + frame_length</span>
<span class="sd">    Based on https://github.com/tensorflow/tensorflow/blob/r1.12/tensorflow/contrib/signal/python/ops/reconstruction_ops.py</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; signal = torch.randn(5, 20)</span>
<span class="sd">    &gt;&gt;&gt; overlapped = overlap_and_add(signal, 20)</span>
<span class="sd">    &gt;&gt;&gt; overlapped.shape</span>
<span class="sd">    torch.Size([100])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">outer_dimensions</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">size</span><span class="p">()[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">frames</span><span class="p">,</span> <span class="n">frame_length</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>

    <span class="n">subframe_length</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span>
        <span class="n">frame_length</span><span class="p">,</span> <span class="n">frame_step</span>
    <span class="p">)</span>  <span class="c1"># gcd=Greatest Common Divisor</span>
    <span class="n">subframe_step</span> <span class="o">=</span> <span class="n">frame_step</span> <span class="o">//</span> <span class="n">subframe_length</span>
    <span class="n">subframes_per_frame</span> <span class="o">=</span> <span class="n">frame_length</span> <span class="o">//</span> <span class="n">subframe_length</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="n">frame_step</span> <span class="o">*</span> <span class="p">(</span><span class="n">frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">frame_length</span>
    <span class="n">output_subframes</span> <span class="o">=</span> <span class="n">output_size</span> <span class="o">//</span> <span class="n">subframe_length</span>

    <span class="n">subframe_signal</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">*</span><span class="n">outer_dimensions</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">subframe_length</span><span class="p">)</span>

    <span class="n">frame</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">output_subframes</span><span class="p">)</span><span class="o">.</span><span class="n">unfold</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">subframes_per_frame</span><span class="p">,</span> <span class="n">subframe_step</span>
    <span class="p">)</span>

    <span class="c1"># frame_old = signal.new_tensor(frame).long()  # signal may in GPU or CPU</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="c1"># print((frame - frame_old).sum())</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span>
        <span class="o">*</span><span class="n">outer_dimensions</span><span class="p">,</span> <span class="n">output_subframes</span><span class="p">,</span> <span class="n">subframe_length</span>
    <span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">index_add_</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">subframe_signal</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">*</span><span class="n">outer_dimensions</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="resynthesize"><a class="viewcode-back" href="../../../speechbrain.processing.signal_processing.html#speechbrain.processing.signal_processing.resynthesize">[docs]</a><span class="k">def</span> <span class="nf">resynthesize</span><span class="p">(</span><span class="n">enhanced_mag</span><span class="p">,</span> <span class="n">noisy_inputs</span><span class="p">,</span> <span class="n">stft</span><span class="p">,</span> <span class="n">istft</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function for resynthesizing waveforms from enhanced mags.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    enhanced_mag : torch.Tensor</span>
<span class="sd">        Predicted spectral magnitude, should be three dimensional.</span>
<span class="sd">    noisy_inputs : torch.Tensor</span>
<span class="sd">        The noisy waveforms before any processing, to extract phase.</span>
<span class="sd">    lengths : torch.Tensor</span>
<span class="sd">        The length of each waveform for normalization.</span>
<span class="sd">    stft : torch.nn.Module</span>
<span class="sd">        Module for computing the STFT for extracting phase.</span>
<span class="sd">    istft : torch.nn.Module</span>
<span class="sd">        Module for computing the iSTFT for resynthesis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    enhanced_wav : torch.Tensor</span>
<span class="sd">        The resynthesized waveforms of the enhanced magnitudes with noisy phase.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Extract noisy phase from inputs</span>
    <span class="n">noisy_feats</span> <span class="o">=</span> <span class="n">stft</span><span class="p">(</span><span class="n">noisy_inputs</span><span class="p">)</span>
    <span class="n">noisy_phase</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">noisy_feats</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">noisy_feats</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Combine with enhanced magnitude</span>
    <span class="n">complex_predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">enhanced_mag</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">noisy_phase</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">noisy_phase</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">pred_wavs</span> <span class="o">=</span> <span class="n">istft</span><span class="p">(</span><span class="n">complex_predictions</span><span class="p">,</span> <span class="n">sig_length</span><span class="o">=</span><span class="n">noisy_inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Normalize. Since we&#39;re using peak amplitudes, ignore lengths</span>
    <span class="n">pred_wavs</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">pred_wavs</span><span class="p">,</span> <span class="n">amp_type</span><span class="o">=</span><span class="s2">&quot;peak&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pred_wavs</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, SpeechBrain

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>