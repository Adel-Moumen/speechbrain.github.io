

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>speechbrain.dataio.dataio &mdash; SpeechBrain 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> SpeechBrain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Quick installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#install-via-pypi">Install via PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#install-locally">Install locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#test-installation">Test Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../experiment.html">Running an experiment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../experiment.html#yaml-basics">YAML basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../experiment.html#running-arguments">Running arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../experiment.html#tensor-format">Tensor format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../multigpu.html">Basics of multi-GPU</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../multigpu.html#multi-gpu-training-using-data-parallel">Multi-GPU training using Data Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../multigpu.html#multi-gpu-training-using-distributed-data-parallel-ddp">Multi-GPU training using Distributed Data Parallel (DDP)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../multigpu.html#with-multiple-machines-suppose-you-have-2-servers-with-2-gpus">With multiple machines (suppose you have 2 servers with 2 GPUs):</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#zen-of-speechbrain">Zen of Speechbrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#how-to-get-your-code-in-speechbrain">How to get your code in SpeechBrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#python">Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#formatting">Formatting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#adding-dependencies">Adding dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#development-tools">Development tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#flake8">flake8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#pre-commit">pre-commit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#the-git-pre-commit-hooks">the git pre-commit hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#the-git-pre-push-hooks">the git pre-push hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#pytest-doctests">pytest doctests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#continuous-integration">Continuous integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#what-is-ci">What is CI?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#ci-cd-pipelines">CI / CD Pipelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../contributing.html#our-test-suite">Our test suite</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#pull-request-review-guide">Pull Request review guide</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../speechbrain.html">Core library (speechbrain)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.core.html">speechbrain.core module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.core.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.core.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.yaml.html">speechbrain.yaml module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.alignment.html">speechbrain.alignment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.alignment.aligner.html">speechbrain.alignment.aligner module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.alignment.aligner.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.alignment.aligner.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.dataio.html">speechbrain.dataio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.batch.html">speechbrain.dataio.batch module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.batch.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.batch.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.dataio.html">speechbrain.dataio.dataio module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataio.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataio.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.dataloader.html">speechbrain.dataio.dataloader module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataloader.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataloader.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.dataset.html">speechbrain.dataio.dataset module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataset.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.dataset.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.encoder.html">speechbrain.dataio.encoder module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.encoder.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.encoder.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.legacy.html">speechbrain.dataio.legacy module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.legacy.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.legacy.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.sampler.html">speechbrain.dataio.sampler module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.sampler.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.sampler.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.wer.html">speechbrain.dataio.wer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.wer.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.dataio.wer.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.dataio.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.decoders.html">speechbrain.decoders</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.decoders.ctc.html">speechbrain.decoders.ctc module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.ctc.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.ctc.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.decoders.seq2seq.html">speechbrain.decoders.seq2seq module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.seq2seq.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.seq2seq.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.decoders.transducer.html">speechbrain.decoders.transducer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.transducer.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.decoders.transducer.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.lm.html">speechbrain.lm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lm.arpa.html">speechbrain.lm.arpa module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.arpa.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.arpa.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lm.counting.html">speechbrain.lm.counting module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.counting.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.counting.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lm.ngram.html">speechbrain.lm.ngram module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.ngram.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lm.ngram.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.lobes.html">speechbrain.lobes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lobes.augment.html">speechbrain.lobes.augment module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.augment.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.augment.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lobes.features.html">speechbrain.lobes.features module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.features.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.features.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.lobes.models.html">speechbrain.lobes.models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.CRDNN.html">speechbrain.lobes.models.CRDNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.ContextNet.html">speechbrain.lobes.models.ContextNet module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.ECAPA_TDNN.html">speechbrain.lobes.models.ECAPA_TDNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.ESPnetVGG.html">speechbrain.lobes.models.ESPnetVGG module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.MetricGAN_D.html">speechbrain.lobes.models.MetricGAN_D module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.RNNLM.html">speechbrain.lobes.models.RNNLM module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.VanillaNN.html">speechbrain.lobes.models.VanillaNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.Xvector.html">speechbrain.lobes.models.Xvector module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.conv_tasnet.html">speechbrain.lobes.models.conv_tasnet module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.convolution.html">speechbrain.lobes.models.convolution module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.dual_path.html">speechbrain.lobes.models.dual_path module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.lobes.models.transformer.html">speechbrain.lobes.models.transformer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.nnet.html">speechbrain.nnet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.CNN.html">speechbrain.nnet.CNN module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.CNN.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.CNN.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.RNN.html">speechbrain.nnet.RNN module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.RNN.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.RNN.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.activations.html">speechbrain.nnet.activations module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.activations.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.activations.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.attention.html">speechbrain.nnet.attention module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.attention.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.attention.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.containers.html">speechbrain.nnet.containers module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.containers.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.containers.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.dropout.html">speechbrain.nnet.dropout module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.dropout.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.dropout.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.embedding.html">speechbrain.nnet.embedding module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.embedding.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.embedding.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.linear.html">speechbrain.nnet.linear module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.linear.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.linear.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.losses.html">speechbrain.nnet.losses module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.losses.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.losses.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.normalization.html">speechbrain.nnet.normalization module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.normalization.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.normalization.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.pooling.html">speechbrain.nnet.pooling module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.pooling.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.pooling.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.schedulers.html">speechbrain.nnet.schedulers module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.schedulers.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.schedulers.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.html">speechbrain.nnet.complex_networks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_CNN.html">speechbrain.nnet.complex_networks.c_CNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_RNN.html">speechbrain.nnet.complex_networks.c_RNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_linear.html">speechbrain.nnet.complex_networks.c_linear module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_normalization.html">speechbrain.nnet.complex_networks.c_normalization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.complex_networks.c_ops.html">speechbrain.nnet.complex_networks.c_ops module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.loss.html">speechbrain.nnet.loss</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.loss.stoi_loss.html">speechbrain.nnet.loss.stoi_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.loss.transducer_loss.html">speechbrain.nnet.loss.transducer_loss module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.html">speechbrain.nnet.quaternion_networks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_CNN.html">speechbrain.nnet.quaternion_networks.q_CNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_RNN.html">speechbrain.nnet.quaternion_networks.q_RNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_linear.html">speechbrain.nnet.quaternion_networks.q_linear module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_normalization.html">speechbrain.nnet.quaternion_networks.q_normalization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.quaternion_networks.q_ops.html">speechbrain.nnet.quaternion_networks.q_ops module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.transducer.html">speechbrain.nnet.transducer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.nnet.transducer.transducer_joint.html">speechbrain.nnet.transducer.transducer_joint module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.nnet.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.processing.html">speechbrain.processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.NMF.html">speechbrain.processing.NMF module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.NMF.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.NMF.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.PLDA_LDA.html">speechbrain.processing.PLDA_LDA module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.PLDA_LDA.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.PLDA_LDA.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.decomposition.html">speechbrain.processing.decomposition module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.decomposition.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.decomposition.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.diarization.html">speechbrain.processing.diarization module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.diarization.html#reference">Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.diarization.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.diarization.html#id1">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.features.html">speechbrain.processing.features module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.features.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.features.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.multi_mic.html">speechbrain.processing.multi_mic module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.multi_mic.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.multi_mic.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.signal_processing.html">speechbrain.processing.signal_processing module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.signal_processing.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.signal_processing.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.processing.speech_augmentation.html">speechbrain.processing.speech_augmentation module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.speech_augmentation.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.processing.speech_augmentation.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.tokenizers.html">speechbrain.tokenizers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.tokenizers.SentencePiece.html">speechbrain.tokenizers.SentencePiece module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.tokenizers.SentencePiece.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.tokenizers.SentencePiece.html#reference">Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.utils.html">speechbrain.utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.Accuracy.html">speechbrain.utils.Accuracy module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.Accuracy.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.Accuracy.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.DER.html">speechbrain.utils.DER module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.DER.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.DER.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.checkpoints.html">speechbrain.utils.checkpoints module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.checkpoints.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.checkpoints.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.convert_model.html">speechbrain.utils.convert_model module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.data_pipeline.html">speechbrain.utils.data_pipeline module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_pipeline.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_pipeline.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.data_utils.html">speechbrain.utils.data_utils module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_utils.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.data_utils.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.depgraph.html">speechbrain.utils.depgraph module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.depgraph.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.depgraph.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.distributed.html">speechbrain.utils.distributed module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.distributed.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.distributed.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.edit_distance.html">speechbrain.utils.edit_distance module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.edit_distance.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.edit_distance.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.epoch_loop.html">speechbrain.utils.epoch_loop module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.epoch_loop.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.epoch_loop.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.logger.html">speechbrain.utils.logger module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.logger.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.logger.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.metric_stats.html">speechbrain.utils.metric_stats module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.metric_stats.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.metric_stats.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.parameter_transfer.html">speechbrain.utils.parameter_transfer module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.parameter_transfer.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.parameter_transfer.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.superpowers.html">speechbrain.utils.superpowers module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.superpowers.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.superpowers.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.train_logger.html">speechbrain.utils.train_logger module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.train_logger.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../speechbrain.utils.train_logger.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../speechbrain.utils.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../speechbrain.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools.html">Runnable Tools (tools)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.compute_wer.html">tools.compute_wer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tools.compute_wer.html#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SpeechBrain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>speechbrain.dataio.dataio</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for speechbrain.dataio.dataio</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Data reading and writing.</span>

<span class="sd">Authors</span>
<span class="sd"> * Mirco Ravanelli 2020</span>
<span class="sd"> * Aku Rouhe 2020</span>
<span class="sd"> * Ju-Chieh Chou 2020</span>
<span class="sd"> * Samuele Cornell 2020</span>
<span class="sd"> * Abdel HEBA 2020</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">torchaudio</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">torchaudio</span><span class="o">.</span><span class="n">set_audio_backend</span><span class="p">(</span><span class="s2">&quot;sox_io&quot;</span><span class="p">)</span>  <span class="c1"># switch backend</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="load_data_json"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.load_data_json">[docs]</a><span class="k">def</span> <span class="nf">load_data_json</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Loads JSON and recursively formats string values.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    json_path : str</span>
<span class="sd">        Path to CSV file.</span>
<span class="sd">    replacements : dict</span>
<span class="sd">        (Optional dict), e.g., {&quot;data_folder&quot;: &quot;/home/speechbrain/data&quot;}.</span>
<span class="sd">        This is used to recursively format all string values in the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        JSON data with replacements applied.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; json_spec = &#39;&#39;&#39;{</span>
<span class="sd">    ...   &quot;ex1&quot;: {&quot;files&quot;: [&quot;{ROOT}/mic1/ex1.wav&quot;, &quot;{ROOT}/mic2/ex1.wav&quot;], &quot;id&quot;: 1},</span>
<span class="sd">    ...   &quot;ex2&quot;: {&quot;files&quot;: [{&quot;spk1&quot;: &quot;{ROOT}/ex2.wav&quot;}, {&quot;spk2&quot;: &quot;{ROOT}/ex2.wav&quot;}], &quot;id&quot;: 2}</span>
<span class="sd">    ... }</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; tmpfile = getfixture(&#39;tmpdir&#39;) / &quot;test.json&quot;</span>
<span class="sd">    &gt;&gt;&gt; with open(tmpfile, &quot;w&quot;) as fo:</span>
<span class="sd">    ...     _ = fo.write(json_spec)</span>
<span class="sd">    &gt;&gt;&gt; data = load_data_json(tmpfile, {&quot;ROOT&quot;: &quot;/home&quot;})</span>
<span class="sd">    &gt;&gt;&gt; data[&quot;ex1&quot;][&quot;files&quot;][0]</span>
<span class="sd">    &#39;/home/mic1/ex1.wav&#39;</span>
<span class="sd">    &gt;&gt;&gt; data[&quot;ex2&quot;][&quot;files&quot;][1][&quot;spk2&quot;]</span>
<span class="sd">    &#39;/home/ex2.wav&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">out_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">_recursive_format</span><span class="p">(</span><span class="n">out_json</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_json</span></div>


<span class="k">def</span> <span class="nf">_recursive_format</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">replacements</span><span class="p">):</span>
    <span class="c1"># Data: dict or list, replacements : dict</span>
    <span class="c1"># Replaces string keys in replacements by their values</span>
    <span class="c1"># at all levels of data (in str values)</span>
    <span class="c1"># Works in-place.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">_recursive_format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">replacements</span><span class="p">)</span>
            <span class="c1"># If not dict, list or str, do nothing</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">_recursive_format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">replacements</span><span class="p">)</span>
            <span class="c1"># If not dict, list or str, do nothing</span>


<div class="viewcode-block" id="load_data_csv"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.load_data_csv">[docs]</a><span class="k">def</span> <span class="nf">load_data_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">replacements</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Loads CSV and formats string values.</span>

<span class="sd">    Uses the SpeechBrain legacy CSV data format, where the CSV must have an</span>
<span class="sd">    &#39;ID&#39; field.</span>
<span class="sd">    If there is a field called duration, it is interpreted as a float.</span>
<span class="sd">    The rest of the fields are left as they are (legacy _format and _opts fields</span>
<span class="sd">    are not used to load the data in any special way).</span>

<span class="sd">    Bash-like string replacements with $to_replace are supported.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    csv_path : str</span>
<span class="sd">        Path to CSV file.</span>
<span class="sd">    replacements : dict</span>
<span class="sd">        (Optional dict), e.g., {&quot;data_folder&quot;: &quot;/home/speechbrain/data&quot;}</span>
<span class="sd">        This is used to recursively format all string values in the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        CSV data with replacements applied.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; csv_spec = &#39;&#39;&#39;ID,duration,wav_path</span>
<span class="sd">    ... utt1,1.45,$data_folder/utt1.wav</span>
<span class="sd">    ... utt2,2.0,$data_folder/utt2.wav</span>
<span class="sd">    ... &#39;&#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; tmpfile = getfixture(&quot;tmpdir&quot;) / &quot;test.csv&quot;</span>
<span class="sd">    &gt;&gt;&gt; with open(tmpfile, &quot;w&quot;) as fo:</span>
<span class="sd">    ...     _ = fo.write(csv_spec)</span>
<span class="sd">    &gt;&gt;&gt; data = load_data_csv(tmpfile, {&quot;data_folder&quot;: &quot;/home&quot;})</span>
<span class="sd">    &gt;&gt;&gt; data[&quot;utt1&quot;][&quot;wav_path&quot;]</span>
<span class="sd">    &#39;/home/utt1.wav&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">variable_finder</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;\$([\w.]+)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="c1"># ID:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>  <span class="c1"># This is used as a key in result, instead.</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s2">&quot;CSV has to have an &#39;ID&#39; field, with unique ids&quot;</span>
                    <span class="s2">&quot; for all data points&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">data_id</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Duplicate id: </span><span class="si">{data_id}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Replacements:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable_finder</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">replacements</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">value</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="n">f</span><span class="s2">&quot;The item </span><span class="si">{value}</span><span class="s2"> requires replacements &quot;</span>
                        <span class="s2">&quot;which were not supplied.&quot;</span>
                    <span class="p">)</span>
            <span class="c1"># Duration:</span>
            <span class="k">if</span> <span class="s2">&quot;duration&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="n">data_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="read_audio"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.read_audio">[docs]</a><span class="k">def</span> <span class="nf">read_audio</span><span class="p">(</span><span class="n">waveforms_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;General audio loading, based on a custom notation.</span>

<span class="sd">    Expected use case is in conjunction with Datasets</span>
<span class="sd">    specified by JSON.</span>

<span class="sd">    The custom notation:</span>

<span class="sd">    The annotation can be just a path to a file:</span>
<span class="sd">    &quot;/path/to/wav1.wav&quot;</span>

<span class="sd">    Or can specify more options in a dict:</span>
<span class="sd">    {&quot;file&quot;: &quot;/path/to/wav2.wav&quot;,</span>
<span class="sd">    &quot;start&quot;: 8000,</span>
<span class="sd">    &quot;stop&quot;: 16000</span>
<span class="sd">    }</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    waveforms_obj : str, dict</span>
<span class="sd">        Audio reading annotation, see above for format.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Audio tensor with shape: (samples, ).</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; dummywav = torch.rand(16000)</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; tmpfile = os.path.join(str(getfixture(&#39;tmpdir&#39;)),  &quot;wave.wav&quot;)</span>
<span class="sd">    &gt;&gt;&gt; write_audio(tmpfile, dummywav, 16000)</span>
<span class="sd">    &gt;&gt;&gt; asr_example = { &quot;wav&quot;: tmpfile, &quot;spk_id&quot;: &quot;foo&quot;, &quot;words&quot;: &quot;foo bar&quot;}</span>
<span class="sd">    &gt;&gt;&gt; loaded = read_audio(asr_example[&quot;wav&quot;])</span>
<span class="sd">    &gt;&gt;&gt; loaded.allclose(dummywav.squeeze(0),atol=1e-4) # replace with eq with sox_io backend</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">waveforms_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">waveforms_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">audio</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">waveforms_obj</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">waveforms_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Default stop to start -&gt; if not specified, num_frames becomes 0,</span>
    <span class="c1"># which is the torchaudio default</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">waveforms_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">num_frames</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span>
    <span class="n">audio</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">num_frames</span><span class="o">=</span><span class="n">num_frames</span><span class="p">,</span> <span class="n">frame_offset</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">audio</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_audio_multichannel"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.read_audio_multichannel">[docs]</a><span class="k">def</span> <span class="nf">read_audio_multichannel</span><span class="p">(</span><span class="n">waveforms_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;General audio loading, based on a custom notation.</span>

<span class="sd">    Expected use case is in conjunction with Datasets</span>
<span class="sd">    specified by JSON.</span>

<span class="sd">    The custom notation:</span>

<span class="sd">    The annotation can be just a path to a file:</span>
<span class="sd">    &quot;/path/to/wav1.wav&quot;</span>

<span class="sd">    Multiple (possibly multi-channel) files can be specified, as long as they</span>
<span class="sd">    have the same length:</span>
<span class="sd">    {&quot;files&quot;: [</span>
<span class="sd">        &quot;/path/to/wav1.wav&quot;,</span>
<span class="sd">        &quot;/path/to/wav2.wav&quot;</span>
<span class="sd">        ]</span>
<span class="sd">    }</span>

<span class="sd">    Or you can specify a single file more succinctly:</span>
<span class="sd">    {&quot;files&quot;: &quot;/path/to/wav2.wav&quot;}</span>

<span class="sd">    Offset number samples and stop number samples also can be specified to read</span>
<span class="sd">    only a segment within the files.</span>
<span class="sd">    {&quot;files&quot;: [</span>
<span class="sd">        &quot;/path/to/wav1.wav&quot;,</span>
<span class="sd">        &quot;/path/to/wav2.wav&quot;</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;start&quot;: 8000</span>
<span class="sd">    &quot;stop&quot;: 16000</span>
<span class="sd">    }</span>

<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">    waveforms_obj : str, dict</span>
<span class="sd">        Audio reading annotation, see above for format.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Audio tensor with shape: (samples, ).</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; dummywav = torch.rand(16000, 2)</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; tmpfile = os.path.join(str(getfixture(&#39;tmpdir&#39;)),  &quot;wave.wav&quot;)</span>
<span class="sd">    &gt;&gt;&gt; write_audio(tmpfile, dummywav, 16000)</span>
<span class="sd">    &gt;&gt;&gt; asr_example = { &quot;wav&quot;: tmpfile, &quot;spk_id&quot;: &quot;foo&quot;, &quot;words&quot;: &quot;foo bar&quot;}</span>
<span class="sd">    &gt;&gt;&gt; loaded = read_audio(asr_example[&quot;wav&quot;])</span>
<span class="sd">    &gt;&gt;&gt; loaded.allclose(dummywav.squeeze(0),atol=1e-4) # replace with eq with sox_io backend</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">waveforms_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">audio</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">waveforms_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">audio</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">files</span> <span class="o">=</span> <span class="n">waveforms_obj</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

    <span class="n">waveforms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">waveforms_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Default stop to start -&gt; if not specified, num_frames becomes 0,</span>
    <span class="c1"># which is the torchaudio default</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">waveforms_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">num_frames</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">audio</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">torchaudio</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">num_frames</span><span class="o">=</span><span class="n">num_frames</span><span class="p">,</span> <span class="n">frame_offset</span><span class="o">=</span><span class="n">start</span>
        <span class="p">)</span>
        <span class="n">waveforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="write_audio"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.write_audio">[docs]</a><span class="k">def</span> <span class="nf">write_audio</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">samplerate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write audio on disk. It is basically a wrapper to support saving</span>
<span class="sd">    audio signals in the speechbrain format (audio, channels).</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    filepath: path</span>
<span class="sd">        Path where to save the audio file.</span>
<span class="sd">    audio : torch.Tensor</span>
<span class="sd">        Audio file in the expected speechbrain format (signal, channels).</span>
<span class="sd">    samplerate: int</span>
<span class="sd">        Sample rate (e.g., 16000).</span>


<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; tmpfile = os.path.join(str(getfixture(&#39;tmpdir&#39;)),  &quot;wave.wav&quot;)</span>
<span class="sd">    &gt;&gt;&gt; dummywav = torch.rand(16000, 2)</span>
<span class="sd">    &gt;&gt;&gt; write_audio(tmpfile, dummywav, 16000)</span>
<span class="sd">    &gt;&gt;&gt; loaded = read_audio(tmpfile)</span>
<span class="sd">    &gt;&gt;&gt; loaded.allclose(dummywav,atol=1e-4) # replace with eq with sox_io backend</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">torchaudio</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">samplerate</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_pickle"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.load_pickle">[docs]</a><span class="k">def</span> <span class="nf">load_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Utility function for loading .pkl pickle files.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    pickle_path : str</span>
<span class="sd">        Path to pickle file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : object</span>
<span class="sd">        Python object loaded from pickle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="to_floatTensor"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.to_floatTensor">[docs]</a><span class="k">def</span> <span class="nf">to_floatTensor</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    x : (list, tuple, np.ndarray)</span>
<span class="sd">        Input data to be converted to torch float.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tensor : torch.tensor</span>
<span class="sd">        Data now in torch.tensor float datatype.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span></div>


<div class="viewcode-block" id="to_doubleTensor"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.to_doubleTensor">[docs]</a><span class="k">def</span> <span class="nf">to_doubleTensor</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    x : (list, tuple, np.ndarray)</span>
<span class="sd">        Input data to be converted to torch double.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tensor : torch.tensor</span>
<span class="sd">        Data now in torch.tensor double datatype.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></div>


<div class="viewcode-block" id="to_longTensor"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.to_longTensor">[docs]</a><span class="k">def</span> <span class="nf">to_longTensor</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    x : (list, tuple, np.ndarray)</span>
<span class="sd">        Input data to be converted to torch long.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tensor : torch.tensor</span>
<span class="sd">        Data now in torch.tensor long datatype.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span></div>


<div class="viewcode-block" id="convert_index_to_lab"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.convert_index_to_lab">[docs]</a><span class="k">def</span> <span class="nf">convert_index_to_lab</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">ind2lab</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a batch of integer IDs to string labels.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    batch : list</span>
<span class="sd">        List of lists, a batch of sequences.</span>
<span class="sd">    ind2lab : dict</span>
<span class="sd">        Mapping from integer IDs to labels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        List of lists, same size as batch, with labels from ind2lab.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; ind2lab = {1: &quot;h&quot;, 2: &quot;e&quot;, 3: &quot;l&quot;, 4: &quot;o&quot;}</span>
<span class="sd">    &gt;&gt;&gt; out = convert_index_to_lab([[4,1], [1,2,3,3,4]], ind2lab)</span>
<span class="sd">    &gt;&gt;&gt; for seq in out:</span>
<span class="sd">    ...     print(&quot;&quot;.join(seq))</span>
<span class="sd">    oh</span>
<span class="sd">    hello</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">ind2lab</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">]</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span></div>


<div class="viewcode-block" id="relative_time_to_absolute"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.relative_time_to_absolute">[docs]</a><span class="k">def</span> <span class="nf">relative_time_to_absolute</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">relative_lens</span><span class="p">,</span> <span class="n">rate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts SpeechBrain style relative length to the absolute duration.</span>

<span class="sd">    Operates on batch level.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    batch : torch.tensor</span>
<span class="sd">        Sequences to determine the duration for.</span>
<span class="sd">    relative_lens : torch.tensor</span>
<span class="sd">        The relative length of each sequence in batch. The longest sequence in</span>
<span class="sd">        the batch needs to have relative length 1.0.</span>
<span class="sd">    rate : float</span>
<span class="sd">        The rate at which sequence elements occur in real-world time. Sample</span>
<span class="sd">        rate, if batch is raw wavs (recommended) or 1/frame_shift if batch is</span>
<span class="sd">        features. This has to have 1/s as the unit.</span>

<span class="sd">    Returns</span>
<span class="sd">    ------:</span>
<span class="sd">    torch.tensor</span>
<span class="sd">        Duration of each sequence in seconds.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; batch = torch.ones(2, 16000)</span>
<span class="sd">    &gt;&gt;&gt; relative_lens = torch.tensor([3./4., 1.0])</span>
<span class="sd">    &gt;&gt;&gt; rate = 16000</span>
<span class="sd">    &gt;&gt;&gt; print(relative_time_to_absolute(batch, relative_lens, rate))</span>
<span class="sd">    tensor([0.7500, 1.0000])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">relative_lens</span> <span class="o">*</span> <span class="n">max_len</span><span class="p">)</span> <span class="o">/</span> <span class="n">rate</span>
    <span class="k">return</span> <span class="n">durations</span></div>


<div class="viewcode-block" id="IterativeCSVWriter"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.IterativeCSVWriter">[docs]</a><span class="k">class</span> <span class="nc">IterativeCSVWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Write CSV files a line at a time.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    outstream : file-object</span>
<span class="sd">        A writeable stream</span>
<span class="sd">    data_fields : list</span>
<span class="sd">        List of the optional keys to write. Each key will be expanded to the</span>
<span class="sd">        SpeechBrain format, producing three fields: key, key_format, key_opts.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import io</span>
<span class="sd">    &gt;&gt;&gt; f = io.StringIO()</span>
<span class="sd">    &gt;&gt;&gt; writer = IterativeCSVWriter(f, [&quot;phn&quot;])</span>
<span class="sd">    &gt;&gt;&gt; print(f.getvalue())</span>
<span class="sd">    ID,duration,phn,phn_format,phn_opts</span>
<span class="sd">    &gt;&gt;&gt; writer.write(&quot;UTT1&quot;,2.5,&quot;sil hh ee ll ll oo sil&quot;,&quot;string&quot;,&quot;&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(f.getvalue())</span>
<span class="sd">    ID,duration,phn,phn_format,phn_opts</span>
<span class="sd">    UTT1,2.5,sil hh ee ll ll oo sil,string,</span>
<span class="sd">    &gt;&gt;&gt; writer.write(ID=&quot;UTT2&quot;,phn=&quot;sil ww oo rr ll dd sil&quot;,phn_format=&quot;string&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(f.getvalue())</span>
<span class="sd">    ID,duration,phn,phn_format,phn_opts</span>
<span class="sd">    UTT1,2.5,sil hh ee ll ll oo sil,string,</span>
<span class="sd">    UTT2,,sil ww oo rr ll dd sil,string,</span>
<span class="sd">    &gt;&gt;&gt; writer.set_default(&#39;phn_format&#39;, &#39;string&#39;)</span>
<span class="sd">    &gt;&gt;&gt; writer.write_batch(ID=[&quot;UTT3&quot;,&quot;UTT4&quot;],phn=[&quot;ff oo oo&quot;, &quot;bb aa rr&quot;])</span>
<span class="sd">    &gt;&gt;&gt; print(f.getvalue())</span>
<span class="sd">    ID,duration,phn,phn_format,phn_opts</span>
<span class="sd">    UTT1,2.5,sil hh ee ll ll oo sil,string,</span>
<span class="sd">    UTT2,,sil ww oo rr ll dd sil,string,</span>
<span class="sd">    UTT3,,ff oo oo,string,</span>
<span class="sd">    UTT4,,bb aa rr,string,</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outstream</span><span class="p">,</span> <span class="n">data_fields</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outstream</span> <span class="o">=</span> <span class="n">outstream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_data_fields</span><span class="p">(</span><span class="n">data_fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outstream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>

<div class="viewcode-block" id="IterativeCSVWriter.set_default"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.IterativeCSVWriter.set_default">[docs]</a>    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a default value for the given CSV field.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        field : str</span>
<span class="sd">            A field in the CSV.</span>
<span class="sd">        value</span>
<span class="sd">            The default value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{field}</span><span class="s2"> is not a field in this CSV!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="IterativeCSVWriter.write"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.IterativeCSVWriter.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes one data line into the CSV.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Supply every field with a value in positional form OR.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Supply certain fields by key. The ID field is mandatory for all</span>
<span class="sd">            lines, but others can be left empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Use either positional fields or named fields, but not both.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need consistent fields&quot;</span><span class="p">)</span>
            <span class="n">to_write</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ID&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;I&#39;ll need to see some ID&quot;</span><span class="p">)</span>
            <span class="n">full_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">full_vals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">to_write</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">full_vals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outstream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outstream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to_write</span><span class="p">))</span></div>

<div class="viewcode-block" id="IterativeCSVWriter.write_batch"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.IterativeCSVWriter.write_batch">[docs]</a>    <span class="k">def</span> <span class="nf">write_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes a batch of lines into the CSV.</span>

<span class="sd">        Here each argument should be a list with the same length.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        *args</span>
<span class="sd">            Supply every field with a value in positional form OR.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Supply certain fields by key. The ID field is mandatory for all</span>
<span class="sd">            lines, but others can be left empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Use either positional fields or named fields, but not both.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need consistent fields&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">arg_row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">*</span><span class="n">arg_row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ID&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;I&#39;ll need to see some ID&quot;</span><span class="p">)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">value_row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">kwarg_row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">value_row</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">**</span><span class="n">kwarg_row</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_expand_data_fields</span><span class="p">(</span><span class="n">data_fields</span><span class="p">):</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data_field</span> <span class="ow">in</span> <span class="n">data_fields</span><span class="p">:</span>
            <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_field</span><span class="p">)</span>
            <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_field</span> <span class="o">+</span> <span class="s2">&quot;_format&quot;</span><span class="p">)</span>
            <span class="n">expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_field</span> <span class="o">+</span> <span class="s2">&quot;_opts&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expanded</span></div>


<div class="viewcode-block" id="write_txt_file"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.write_txt_file">[docs]</a><span class="k">def</span> <span class="nf">write_txt_file</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write data in text format.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    data : str, list, torch.tensor, numpy.ndarray</span>
<span class="sd">        The data to write in the text file.</span>
<span class="sd">    filename : str</span>
<span class="sd">        Path to file where to write the data.</span>
<span class="sd">    sampling_rate : None</span>
<span class="sd">        Not used, just here for interface compatibility.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; tmpdir = getfixture(&#39;tmpdir&#39;)</span>
<span class="sd">    &gt;&gt;&gt; signal=torch.tensor([1,2,3,4])</span>
<span class="sd">    &gt;&gt;&gt; write_txt_file(signal, os.path.join(tmpdir, &#39;example.txt&#39;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">del</span> <span class="n">sampling_rate</span>  <span class="c1"># Not used.</span>
    <span class="c1"># Check if the path of filename exists</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span></div>


<div class="viewcode-block" id="write_stdout"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.write_stdout">[docs]</a><span class="k">def</span> <span class="nf">write_stdout</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write data to standard output.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    data : str, list, torch.tensor, numpy.ndarray</span>
<span class="sd">        The data to write in the text file.</span>
<span class="sd">    filename : None</span>
<span class="sd">        Not used, just here for compatibility.</span>
<span class="sd">    sampling_rate : None</span>
<span class="sd">        Not used, just here for compatibility.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; tmpdir = getfixture(&#39;tmpdir&#39;)</span>
<span class="sd">    &gt;&gt;&gt; signal = torch.tensor([[1,2,3,4]])</span>
<span class="sd">    &gt;&gt;&gt; write_stdout(signal, tmpdir + &#39;/example.txt&#39;)</span>
<span class="sd">    [1, 2, 3, 4]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Managing Torch.Tensor</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Managing np.ndarray</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="length_to_mask"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.length_to_mask">[docs]</a><span class="k">def</span> <span class="nf">length_to_mask</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a binary mask for each sequence.</span>

<span class="sd">    Reference: https://discuss.pytorch.org/t/how-to-generate-variable-length-mask/23397/3</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    length : torch.LongTensor</span>
<span class="sd">        Containing the length of each sequence in the batch. Must be 1D.</span>
<span class="sd">    max_len : int</span>
<span class="sd">        Max length for the mask, also the size of the second dimension.</span>
<span class="sd">    dtype : torch.dtype, default: None</span>
<span class="sd">        The dtype of the generated mask.</span>
<span class="sd">    device: torch.device, default: None</span>
<span class="sd">        The device to put the mask variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mask : tensor</span>
<span class="sd">        The binary mask.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; length=torch.Tensor([1,2,3])</span>
<span class="sd">    &gt;&gt;&gt; mask=length_to_mask(length)</span>
<span class="sd">    &gt;&gt;&gt; mask</span>
<span class="sd">    tensor([[1., 0., 0.],</span>
<span class="sd">            [1., 1., 0.],</span>
<span class="sd">            [1., 1., 1.]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">length</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">max_len</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">long</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>  <span class="c1"># using arange to generate mask</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
        <span class="n">max_len</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">length</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">length</span><span class="o">.</span><span class="n">dtype</span>
    <span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="n">max_len</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">dtype</span>

    <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">device</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span></div>


<div class="viewcode-block" id="read_kaldi_lab"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.read_kaldi_lab">[docs]</a><span class="k">def</span> <span class="nf">read_kaldi_lab</span><span class="p">(</span><span class="n">kaldi_ali</span><span class="p">,</span> <span class="n">kaldi_lab_opts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read labels in kaldi format.</span>

<span class="sd">    Uses kaldi IO.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    kaldi_ali : str</span>
<span class="sd">        Path to directory where kaldi alignents are stored.</span>
<span class="sd">    kaldi_lab_opts : str</span>
<span class="sd">        A string that contains the options for reading the kaldi alignments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lab : dict</span>
<span class="sd">        A dictionary contaning the labels.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    This depends on kaldi-io-for-python. Install it separately.</span>
<span class="sd">    See: https://github.com/vesis84/kaldi-io-for-python</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    This example requires kaldi files.</span>
<span class="sd">    ```</span>
<span class="sd">    lab_folder = &#39;/home/kaldi/egs/TIMIT/s5/exp/dnn4_pretrain-dbn_dnn_ali&#39;</span>
<span class="sd">    read_kaldi_lab(lab_folder, &#39;ali-to-pdf&#39;)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># EXTRA TOOLS</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">kaldi_io</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Could not import kaldi_io. Install it to use this.&quot;</span><span class="p">)</span>
    <span class="c1"># Reading the Kaldi labels</span>
    <span class="n">lab</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kaldi_io</span><span class="o">.</span><span class="n">read_vec_int_ark</span><span class="p">(</span>
            <span class="s2">&quot;gunzip -c &quot;</span>
            <span class="o">+</span> <span class="n">kaldi_ali</span>
            <span class="o">+</span> <span class="s2">&quot;/ali*.gz | &quot;</span>
            <span class="o">+</span> <span class="n">kaldi_lab_opts</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="n">kaldi_ali</span>
            <span class="o">+</span> <span class="s2">&quot;/final.mdl ark:- ark:-|&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">lab</span></div>


<div class="viewcode-block" id="get_md5"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.get_md5">[docs]</a><span class="k">def</span> <span class="nf">get_md5</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the md5 checksum of an input file.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    file : str</span>
<span class="sd">        Path to file for which compute the checksum.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    md5</span>
<span class="sd">        Checksum for the given filepath.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; get_md5(&#39;samples/audio_samples/example1.wav&#39;)</span>
<span class="sd">    &#39;c482d0081ca35302d30d12f1136c34e5&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lets read stuff in 64kb chunks!</span>
    <span class="n">BUF_SIZE</span> <span class="o">=</span> <span class="mi">65536</span>
    <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="c1"># Computing md5</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BUF_SIZE</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>


<div class="viewcode-block" id="save_md5"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.save_md5">[docs]</a><span class="k">def</span> <span class="nf">save_md5</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">out_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves the md5 of a list of input files as a pickled dict into a file.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    files : list</span>
<span class="sd">        List of input files from which we will compute the md5.</span>
<span class="sd">    outfile : str</span>
<span class="sd">        The path where to store the output pkl file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; files = [&#39;samples/audio_samples/example1.wav&#39;]</span>
<span class="sd">    &gt;&gt;&gt; tmpdir = getfixture(&#39;tmpdir&#39;)</span>
<span class="sd">    &gt;&gt;&gt; save_md5(files, os.path.join(tmpdir, &quot;md5.pkl&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialization of the dictionary</span>
    <span class="n">md5_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Computing md5 for all the files in the list</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">md5_dict</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_md5</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="c1"># Saving dictionary in pkl format</span>
    <span class="n">save_pkl</span><span class="p">(</span><span class="n">md5_dict</span><span class="p">,</span> <span class="n">out_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_pkl"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.save_pkl">[docs]</a><span class="k">def</span> <span class="nf">save_pkl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save an object in pkl format.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    obj : object</span>
<span class="sd">        Object to save in pkl format</span>
<span class="sd">    file : str</span>
<span class="sd">        Path to the output file</span>
<span class="sd">    sampling_rate : int</span>
<span class="sd">        Sampling rate of the audio file, TODO: this is not used?</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; tmpfile = os.path.join(getfixture(&#39;tmpdir&#39;), &quot;example.pkl&quot;)</span>
<span class="sd">    &gt;&gt;&gt; save_pkl([1, 2, 3, 4, 5], tmpfile)</span>
<span class="sd">    &gt;&gt;&gt; load_pkl(tmpfile)</span>
<span class="sd">    [1, 2, 3, 4, 5]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_pkl"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.load_pkl">[docs]</a><span class="k">def</span> <span class="nf">load_pkl</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a pkl file.</span>

<span class="sd">    For an example, see `save_pkl`.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    file : str</span>
<span class="sd">        Path to the input pkl file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The loaded object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Deals with the situation where two processes are trying</span>
    <span class="c1"># to access the same label dictionary by creating a lock</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">while</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span> <span class="o">+</span> <span class="s2">&quot;.lock&quot;</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">file</span> <span class="o">+</span> <span class="s2">&quot;.lock&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span> <span class="o">+</span> <span class="s2">&quot;.lock&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span> <span class="o">+</span> <span class="s2">&quot;.lock&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="prepend_bos_token"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.prepend_bos_token">[docs]</a><span class="k">def</span> <span class="nf">prepend_bos_token</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">bos_index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create labels with &lt;bos&gt; token at the beginning.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    label : torch.IntTensor</span>
<span class="sd">        Containing the original labels. Must be of size: [batch_size, max_length].</span>
<span class="sd">    bos_index : int</span>
<span class="sd">        The index for &lt;bos&gt; token.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_label : tensor</span>
<span class="sd">        The new label with &lt;bos&gt; at the beginning.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; label=torch.LongTensor([[1,0,0], [2,3,0], [4,5,6]])</span>
<span class="sd">    &gt;&gt;&gt; new_label=prepend_bos_token(label, bos_index=7)</span>
<span class="sd">    &gt;&gt;&gt; new_label</span>
<span class="sd">    tensor([[7, 1, 0, 0],</span>
<span class="sd">            [7, 2, 3, 0],</span>
<span class="sd">            [7, 4, 5, 6]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">long</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">bos</span> <span class="o">=</span> <span class="n">new_label</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fill_</span><span class="p">(</span><span class="n">bos_index</span><span class="p">)</span>
    <span class="n">new_label</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">bos</span><span class="p">,</span> <span class="n">new_label</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_label</span></div>


<div class="viewcode-block" id="append_eos_token"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.append_eos_token">[docs]</a><span class="k">def</span> <span class="nf">append_eos_token</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">eos_index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create labels with &lt;eos&gt; token appended.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    label : torch.IntTensor</span>
<span class="sd">        Containing the original labels. Must be of size: [batch_size, max_length]</span>
<span class="sd">    length : torch.LongTensor</span>
<span class="sd">        Cotaining the original length of each label sequences. Must be 1D.</span>
<span class="sd">    eos_index : int</span>
<span class="sd">        The index for &lt;eos&gt; token.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_label : tensor</span>
<span class="sd">        The new label with &lt;eos&gt; appended.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; label=torch.IntTensor([[1,0,0], [2,3,0], [4,5,6]])</span>
<span class="sd">    &gt;&gt;&gt; length=torch.LongTensor([1,2,3])</span>
<span class="sd">    &gt;&gt;&gt; new_label=append_eos_token(label, length, eos_index=7)</span>
<span class="sd">    &gt;&gt;&gt; new_label</span>
<span class="sd">    tensor([[1, 7, 0, 0],</span>
<span class="sd">            [2, 3, 7, 0],</span>
<span class="sd">            [4, 5, 6, 7]], dtype=torch.int32)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">pad</span> <span class="o">=</span> <span class="n">new_label</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">new_label</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">new_label</span><span class="p">,</span> <span class="n">pad</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">new_label</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">batch_size</span><span class="p">),</span> <span class="n">length</span><span class="o">.</span><span class="n">long</span><span class="p">()]</span> <span class="o">=</span> <span class="n">eos_index</span>
    <span class="k">return</span> <span class="n">new_label</span></div>


<div class="viewcode-block" id="merge_char"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.merge_char">[docs]</a><span class="k">def</span> <span class="nf">merge_char</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge characters sequences into word sequences.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    sequences : list</span>
<span class="sd">        Each item contains a list, and this list contains a character sequence.</span>
<span class="sd">    space : string</span>
<span class="sd">        The token represents space. Default: _</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The list contains word sequences for each sentence.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; sequences = [[&quot;a&quot;, &quot;b&quot;, &quot;_&quot;, &quot;c&quot;, &quot;_&quot;, &quot;d&quot;, &quot;e&quot;], [&quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;_&quot;, &quot;h&quot;, &quot;i&quot;]]</span>
<span class="sd">    &gt;&gt;&gt; results = merge_char(sequences)</span>
<span class="sd">    &gt;&gt;&gt; results</span>
<span class="sd">    [[&#39;ab&#39;, &#39;c&#39;, &#39;de&#39;], [&#39;efg&#39;, &#39;hi&#39;]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="merge_csvs"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.merge_csvs">[docs]</a><span class="k">def</span> <span class="nf">merge_csvs</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">csv_lst</span><span class="p">,</span> <span class="n">merged_csv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merging several csv files into one file.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    data_folder : string</span>
<span class="sd">        The folder to store csv files to be merged and after merging.</span>
<span class="sd">    csv_lst : list</span>
<span class="sd">        Filenames of csv file to be merged.</span>
<span class="sd">    merged_csv : string</span>
<span class="sd">        The filename to write the merged csv file.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; merge_csvs(&quot;samples/audio_samples/&quot;,</span>
<span class="sd">    ... [&quot;csv_example.csv&quot;, &quot;csv_example2.csv&quot;],</span>
<span class="sd">    ... &quot;test_csv_merge.csv&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">write_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">merged_csv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">write_path</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping merging. Completed in previous run.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">csv_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">csv_lst</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Checking header</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="n">header</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Different header for &quot;</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{csv_lst[0]}</span><span class="s2"> and </span><span class="si">{csv}</span><span class="s2">.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">write_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{write_path}</span><span class="s2"> is created.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="split_word"><a class="viewcode-back" href="../../../speechbrain.dataio.dataio.html#speechbrain.dataio.dataio.split_word">[docs]</a><span class="k">def</span> <span class="nf">split_word</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split word sequences into character sequences.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    sequences : list</span>
<span class="sd">        Each item contains a list, and this list contains a words sequence.</span>
<span class="sd">    space : string</span>
<span class="sd">        The token represents space. Default: _</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    The list contains word sequences for each sentence.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; sequences = [[&#39;ab&#39;, &#39;c&#39;, &#39;de&#39;], [&#39;efg&#39;, &#39;hi&#39;]]</span>
<span class="sd">    &gt;&gt;&gt; results = split_word(sequences)</span>
<span class="sd">    &gt;&gt;&gt; results</span>
<span class="sd">    [[&#39;a&#39;, &#39;b&#39;, &#39;_&#39;, &#39;c&#39;, &#39;_&#39;, &#39;d&#39;, &#39;e&#39;], [&#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;_&#39;, &#39;h&#39;, &#39;i&#39;]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">:</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, SpeechBrain

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>